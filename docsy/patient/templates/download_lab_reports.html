<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.3/jspdf.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
   
    
    {% load static %}
</head>
<body>
    <div>
        <!-- <button  id="downloadbtn" style="display: inline-block;"><b>Click to Download HTML as PDF</b></button> -->
    </div>
       
    <div class="canvas_div_pdf">

       
        <section class="feature-section section bg-gray" id="lab-result">
            <div class="container">
              <div class="section-title text-center">
                <h3>Lab Results </h3>
                <p class="mb-0"></p>
              </div>
      
              
              
              <div class="row">
            <div class="slider owl-carousel">
            {% if report %}
              {% for i in labreports %}
                  
                    
        
                  <div class="item "  style="margin-top: 5%;margin-bottom: 5%;margin-right:20px;" >
                    <div class="card" style="width: 100%; height:100%;" >
                      <div class="card-body" style="align-items: center;">
                       
                          <div class="card-body row">
                              <div class="col-3"><p> <b>Name :</b>{{patient_details.name}}</p></div>
                              <div class="col-3"><p><b>lab Event :</b> {{i.lab_event}}</p></div>
                              <div class="col-3"><p><b>Test Name :</b> {{i.lab_test_name}}</p></div>
                              <div class="col-3"><p><b>Specimen Type :</b>{{i.lab_specimen_type}}</p> </div>
                          </div>
                          
                          <div class=" card-body  row">
                
                            <div class="col-3"><p><b>Method :</b>{{i.lab_specimen_method}}</p> </div>
                            <div class="col-3"> <p><b>Body Site</b>{{i.lab_specimen_body_site}}</p> </div>
                            <div class="col-3"><p><b>Findings :</b> {{i.lab_findings}}</p></div>
                            <div class="col-3"><btn onclick="getPDF()" class="btn" style="float:right; background-color:cadetblue; color: white;">Download</button>
                            </div>
                        </div>
                          
                      
                          <img src="{% static i.lab_document %}" style="width:100%;height:70%;" />
                              
                          <br><br>
                        <btn onclick="getPDF()" class="btn" style="float:right; background-color:cadetblue; color: white;">Download</a>

                      </div>
                    </div>
                  </div>
               
                  
              
            {% endfor %}
            {% else %}
            {% for i in labreports %}
                  
                    
        
            <div class="item "  style="margin-top: 5%;margin-bottom: 5%;margin-right:20px;" >
              <div class="card" style="width: 100%; height:100%;" >
                <div class="card-body" style="align-items: center;">
                 
                    <div class="card-body row">
                        <div class="col-3"><p> <b>Name :</b>{{patient_details.name}}</p></div>
                        <div class="col-3"><p><b>lab Event :</b> {{i.imaging_event}}</p></div>
                        <div class="col-3"><p><b>Test Name :</b> {{i.imaging_test_name}}</p></div>
                        <div class="col-3"><p><b>Specimen Modality :</b>{{i.imaging_modality}}</p> </div>
                    </div>
                    
                    <div class=" card-body  row">
          
                      
                      <div class="col-3"> <p><b>Body Site</b>{{i.imaging_body_site}}</p> </div>
                      <div class="col-3"><p><b>Findings :</b> {{i.imaging_findings}}</p></div>
                      <div class="col-3"></div>
                      <div class="col-3"><btn onclick="getPDF()" class="btn" style="float:right; background-color:cadetblue; color: white;">Download</button>
                      </div>
                  </div>
                    <img src="{% static i.imaging_document %}"  style="width:100%;height:70%;" />
                        
                    <br><br>
                  <btn onclick="getPDF()" class="btn" style="float:right; background-color:cadetblue; color: white;">Download</a>

                </div>
              </div>
            </div>
         
            
        
      {% endfor %}

            {% endif %}
           
       
            </div>
          </div>
                       
        </div>
          </section>
        
        </div> 
        <script>
function getPDF(){

var HTML_Width = $(".canvas_div_pdf").width();
var HTML_Height = $(".canvas_div_pdf").height();
var top_left_margin = 15;
var PDF_Width = HTML_Width+(top_left_margin*2);
var PDF_Height = (PDF_Width*1.5)+(top_left_margin*2);
var canvas_image_width = HTML_Width;
var canvas_image_height = HTML_Height;

var totalPDFPages = Math.ceil(HTML_Height/PDF_Height)-1;


html2canvas($(".canvas_div_pdf")[0],{allowTaint:true}).then(function(canvas) {
    canvas.getContext('2d');
    
    console.log(canvas.height+"  "+canvas.width);
    
    
    var imgData = canvas.toDataURL("image/jpeg", 1.0);
    var pdf = new jsPDF('p', 'pt',  [PDF_Width, PDF_Height]);
    pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin,canvas_image_width,canvas_image_height);
    
    
    for (var i = 1; i <= totalPDFPages; i++) { 
        pdf.addPage(PDF_Width, PDF_Height);
        pdf.addImage(imgData, 'JPG', top_left_margin, -(PDF_Height*i)+(top_left_margin*4),canvas_image_width,canvas_image_height);
    }
    
    pdf.save("HTML-Document.pdf");
});
};
        </script>
  
</body>
</html>